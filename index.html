<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>METHOD VERÄ°N CAKKKALLLAER</title>
    <style>
        /* Genel Stil ve YerleÅŸim */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 750px; 
            margin: 40px auto; 
            padding: 25px; 
            background-color: #f8f9fa; 
            color: #343a40; 
            border-radius: 10px; 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); 
        }
        h2 { 
            text-align: center; 
            color: #007bff; 
            border-bottom: 2px solid #007bff; 
            padding-bottom: 10px; 
            margin-bottom: 20px; 
        }
        h3 { 
            color: #343a40; 
            margin-top: 20px; 
        }
        hr { 
            border: 0; 
            height: 1px; 
            background: #dee2e6; 
            margin: 25px 0; 
        }

        /* Form ElemanlarÄ± */
        label { 
            display: block; 
            margin-bottom: 5px; 
            font-weight: 600; 
        }
        textarea, input[type="text"] { 
            width: 100%; 
            padding: 12px; 
            margin-bottom: 15px; 
            border: 1px solid #ced4da; 
            border-radius: 5px; 
            box-sizing: border-box; 
            resize: vertical; 
            font-size: 14px; 
        }
        textarea { 
            min-height: 120px; 
        }

        /* Butonlar */
        button { 
            padding: 10px 20px; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            margin-right: 10px; 
            transition: background-color 0.3s; 
            font-weight: 600; 
        }
        #checkButton { 
            background-color: #28a745; 
        }
        #checkButton:hover:not(:disabled) { 
            background-color: #218838; 
        }
        #checkButton:disabled { 
            background-color: #90ee90; 
            cursor: not-allowed; 
        }
        #settingsPanel button { 
            background-color: #007bff; 
        }
        #settingsPanel button:hover { 
            background-color: #0056b3; 
        }
        
        /* Ayarlar Paneli */
        .settings-panel { 
            border: 1px dashed #adb5bd; 
            padding: 20px; 
            margin-top: 15px; 
            background-color: #e9ecef; 
            border-radius: 5px; 
        }

        /* SonuÃ§ KutucuÄŸu */
        .result-box { 
            margin-top: 30px; 
            padding: 20px; 
            border: 2px solid #ffc107; 
            background-color: #fff3cd; 
            border-radius: 5px; 
        }
        #robustList { 
            list-style-type: none; 
            padding-left: 0; 
        }
        #robustList li { 
            padding: 8px 0; 
            border-bottom: 1px dashed #ffc107; 
            font-size: 1.1em;
        }
        #robustList li:last-child { 
            border-bottom: none; 
        }

        /* Durum MesajlarÄ± */
        .success { 
            color: #155724; 
            font-weight: bold; 
        }
        .error { 
            color: #721c24; 
            background-color: #f8d7da; 
            border: 1px solid #f5c6cb; 
            padding: 10px; 
            border-radius: 5px; 
            margin-top: 10px;
        }
        #settingsStatus { 
            font-weight: 600; 
            margin-top: 10px;
        }
        #statusMessage {
            font-weight: 600;
            padding: 10px;
            margin-top: 15px;
            border-radius: 5px;
            background-color: #d1ecf1;
            color: #0c5460;
        }
    </style>
</head>
<body>

    <h2>1 SÄ°KE 5 AM</h2>
    
    <button onclick="toggleSettings()" style="background-color: #6c757d;">âš™ï¸ AyarlarÄ± AÃ§ / Kapat</button>

    <div id="settingsPanel" class="settings-panel" style="display: none;">
        <h3>API AyarlarÄ± (KalÄ±cÄ± Oturum Bilgileri)</h3>
        <p style="color: #6c757d; font-size: 0.9em;">Token ve Cookie bilgileri, sayfa yenilense bile tarayÄ±cÄ±nÄ±zda kalÄ±cÄ± olarak saklanacaktÄ±r.</p>
        
        <label for="cookieInput">Cookie BaÅŸlÄ±ÄŸÄ± (Tam DeÄŸer):</label>
        <textarea id="cookieInput" style="height: 80px;" placeholder="language=tr; currency=TRY; happyuyeol=1; ..."></textarea>
        
        <label for="csrfTokenInput">CSRF Token DeÄŸeri:</label>
        <input type="text" id="csrfTokenInput" placeholder="9a4916d15120cb84ca6d599f60059e46a647577b89b701789da9d7199ca5ac68">
        
        <button onclick="saveSettings()">AyarlarÄ± Kaydet ve Kullan</button>
        <p id="settingsStatus" style="margin-top: 5px;"></p>
    </div>

    <hr>
    
    <label for="cardInput">Kontrol Edilecek Kart NumaralarÄ± (Her satÄ±ra bir tane):</label>
    <textarea id="cardInput" placeholder="Ã–rn: 4540123456789012&#10;4540987654321098"></textarea>
    
    <button id="checkButton" onclick="checkCards()">KontrolÃ¼ BaÅŸlat</button>

    <div id="statusMessage">Kontrol iÃ§in hazÄ±r. LÃ¼tfen kart numaralarÄ±nÄ± giriniz.</div>

    <div class="result-box">
        <h3>ğŸ‰ PuanlÄ± Kartlar </h3>
        <ul id="robustList" style="list-style-type: none; padding-left: 0;">
            </ul>
        <p id="noResults" style="color: gray;">Kontrol tamamlandÄ±ÄŸÄ±nda puanlÄ± kartlar burada listelenecektir.</p>
    </div>

    <script>
        const API_ENDPOINT = '/check_cards'; 

        // BaÅŸlangÄ±Ã§ta global deÄŸiÅŸkenleri boÅŸ bÄ±rakÄ±yoruz. DeÄŸerleri localStorage'dan yÃ¼klenecek.
        let currentCookie = ""; 
        let currentCsrfToken = "";

        // --- AyarlarÄ± localStorage'dan YÃ¼kle ---
        function loadSettingsFromStorage() {
            const savedCookie = localStorage.getItem('appCookie');
            const savedCsrfToken = localStorage.getItem('appCsrfToken');

            // KayÄ±tlÄ± deÄŸer varsa kullan, yoksa baÅŸlangÄ±Ã§ placeholder'Ä±nÄ± kullan
            if (savedCookie) {
                currentCookie = savedCookie;
                document.getElementById('cookieInput').value = savedCookie;
            } else {
                 document.getElementById('cookieInput').value = "language=tr; currency=TRY; happyuyeol=1; ...";
            }
            
            if (savedCsrfToken) {
                currentCsrfToken = savedCsrfToken;
                document.getElementById('csrfTokenInput').value = savedCsrfToken;
            } else {
                document.getElementById('csrfTokenInput').value = "9a4916d15120cb84ca6d599f60059e46a647577b89b701789da9d7199ca5ac68";
            }
        }


        // Sayfa yÃ¼klendiÄŸinde ayarlarÄ± yÃ¼kle
        document.addEventListener('DOMContentLoaded', loadSettingsFromStorage);


        // --- AyarlarÄ± Kaydet ve KalÄ±cÄ± Hale Getir ---
        function saveSettings() {
            const newCookie = document.getElementById('cookieInput').value.trim();
            const newCsrfToken = document.getElementById('csrfTokenInput').value.trim();
            const status = document.getElementById('settingsStatus');

            if (!newCookie || !newCsrfToken) {
                status.textContent = 'âš ï¸ Cookie ve CSRF Token boÅŸ olamaz!';
                status.style.color = 'red';
                return;
            }

            // Global deÄŸiÅŸkenleri gÃ¼ncelle
            currentCookie = newCookie;
            currentCsrfToken = newCsrfToken;
            
            // Verileri localStorage'a KAYDET (KalÄ±cÄ±lÄ±k saÄŸlanÄ±r)
            localStorage.setItem('appCookie', newCookie);
            localStorage.setItem('appCsrfToken', newCsrfToken);
            
            status.textContent = 'âœ… Ayarlar baÅŸarÄ±yla kaydedildi!';
            status.style.color = 'green';
        }

        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }


        // --- Kart Kontrol Fonksiyonu ---
        async function checkCards() {
            if (!currentCookie || !currentCsrfToken) {
                document.getElementById('statusMessage').innerHTML = '<span class="error">LÃ¼tfen Ã¶nce **Ayarlar** panelinden Cookie ve CSRF Token deÄŸerlerini girip kaydedin!</span>';
                return;
            }
            
            const cardInput = document.getElementById('cardInput').value;
            const checkButton = document.getElementById('checkButton');
            const statusMessage = document.getElementById('statusMessage');
            const robustList = document.getElementById('robustList');
            const noResults = document.getElementById('noResults');

            robustList.innerHTML = '';
            noResults.style.display = 'block';
            statusMessage.innerHTML = 'Kontrol **baÅŸlatÄ±ldÄ±**... Sunucudan yanÄ±t bekleniyor.';
            checkButton.disabled = true;

            const cards = cardInput.split('\n')
                                   .map(line => line.trim())
                                   .filter(line => line.length > 0);
            
            if (cards.length === 0) {
                statusMessage.innerHTML = '<span class="error">LÃ¼tfen kontrol edilecek kart numaralarÄ±nÄ± girin.</span>';
                checkButton.disabled = false;
                return;
            }

            const totalCards = cards.length;
            let cardsProcessed = 0;
            let foundCardsCount = 0;

            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-App-Cookie': currentCookie,       
                        'X-App-Csrf': currentCsrfToken       
                    },
                    body: JSON.stringify({ cards: cards })
                });

                const result = await response.json();

                if (response.ok) {
                    
                    const robustCards = result.robustCards || [];
                    
                    // AkÄ±ÅŸ Efekti: Gelen puanlÄ± kartlarÄ± sÄ±rayla listeye ekle ve durumu gÃ¼ncelle
                    for (const cardData of robustCards) {
                        cardsProcessed++;
                        foundCardsCount++;

                        const listItem = document.createElement('li');
                        listItem.className = 'success';
                        listItem.innerHTML = `ğŸ’³ **${cardData.cardNumber}** (BitiÅŸ: ${cardData.expiry}) â†’ **${cardData.amount} TL** Puan!`;
                        robustList.appendChild(listItem);
                        
                        // Durum mesajÄ±nÄ± akÄ±ÅŸ sÄ±rasÄ±nda gÃ¼ncelle
                        statusMessage.innerHTML = `âœ… **${foundCardsCount}** puanlÄ± kart bulundu ve listeye eklendi. Kontrol devam ediyor...`;
                        
                        // KÄ±sa bir bekleme, listenin anlÄ±k gÃ¼ncelleniyormuÅŸ gibi gÃ¶rÃ¼nmesini saÄŸlar.
                        await new Promise(r => setTimeout(r, 100)); 
                    }
                    
                    // Ä°ÅŸlenmesi gereken tÃ¼m kartlar kontrol edildi varsayÄ±lÄ±r (Arka uÃ§ tek seferde kontrolÃ¼ bitirir)
                    statusMessage.innerHTML = `âœ… **TÃ¼m kartlarÄ±n** (${totalCards} adet) kontrolÃ¼ tamamlandÄ±! Toplam **${foundCardsCount}** puanlÄ± kart bulundu.`;


                    if (robustCards.length === 0) {
                        noResults.textContent = 'Kontrol edilen kartlar arasÄ±nda puanlÄ± kart bulunamadÄ±.';
                        noResults.style.display = 'block';
                    } else {
                        noResults.style.display = 'none';
                    }

                } else {
                    statusMessage.innerHTML = `<span class="error">Hata: Sunucu hatasÄ± (${response.status}). ${result.error || 'Bilinmeyen Hata.'}</span>`;
                }

            } catch (error) {
                statusMessage.innerHTML = `<span class="error">BaÄŸlantÄ± HatasÄ±: API sunucusuna ulaÅŸÄ±lamÄ±yor. (${error.message})</span>`;
            } finally {
                checkButton.disabled = false;
            }
        }
    </script>
</body>
</html>
